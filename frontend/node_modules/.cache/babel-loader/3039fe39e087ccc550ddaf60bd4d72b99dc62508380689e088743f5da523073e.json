{"ast":null,"code":"var _jsxFileName = \"C:\\\\vscProjekti\\\\spletno\\\\AtmoTracker\\\\frontend\\\\src\\\\components\\\\WebSocketMap.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { MapContainer, TileLayer, Marker, Popup } from 'react-leaflet';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\n\n// Fix the default icon issue with Leaflet in React\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon-2x.png',\n  iconUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',\n  shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png'\n});\nconst WebSocketMap = () => {\n  _s();\n  const [data, setData] = useState([]);\n  const [socket, setSocket] = useState(null);\n  const connectWebSocket = () => {\n    const newSocket = new WebSocket('ws://localhost:3002');\n    newSocket.onopen = () => {\n      console.log('Connected to WebSocket server');\n    };\n    newSocket.onmessage = event => {\n      const receivedData = JSON.parse(event.data);\n      console.log('Received data:', receivedData);\n      setData(receivedData);\n    };\n    newSocket.onclose = event => {\n      console.log('Disconnected from WebSocket server', event);\n      // Reconnect after a short delay\n      setTimeout(connectWebSocket, 1000);\n    };\n    newSocket.onerror = error => {\n      console.error('WebSocket error:', error);\n    };\n    setSocket(newSocket);\n  };\n  useEffect(() => {\n    connectWebSocket();\n    return () => {\n      if (socket) {\n        console.log('Closing WebSocket connection');\n        socket.close();\n      }\n    };\n  }, []);\n  const updateMap = data => {\n    return data.map((item, index) => {\n      const {\n        latitude,\n        longitude\n      } = item.data_series_id.location;\n      let popupContent = `<strong>${item.data_series_id.name}</strong><br>No relevant data available.`;\n      if (item.data_series_id.name.startsWith('Weather')) {\n        popupContent = `\n          <strong>${item.data_series_id.name}</strong><br>\n          Wind Speed: ${item.data.windSpeed || 'N/A'}<br>\n          Wind Gusts: ${item.data.windGusts || 'N/A'}<br>\n          Precipitation: ${item.data.precipitation || 'N/A'}\n        `;\n      } else if (item.data_series_id.name.startsWith('AirQuality')) {\n        popupContent = `\n          <strong>${item.data_series_id.name}</strong><br>\n          PM10: ${item.data.pm10 || 'N/A'}<br>\n          PM2.5: ${item.data.pm25 || 'N/A'}<br>\n          Ozone: ${item.data.ozon || 'N/A'}<br>\n          NO2: ${item.data.no2 || 'N/A'}\n        `;\n      }\n      return /*#__PURE__*/_jsxDEV(Marker, {\n        position: [latitude, longitude],\n        children: /*#__PURE__*/_jsxDEV(Popup, {\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            dangerouslySetInnerHTML: {\n              __html: popupContent\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 80,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 79,\n          columnNumber: 11\n        }, this)\n      }, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 9\n      }, this);\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(MapContainer, {\n      center: [46.11929097137821, 14.756128960803503],\n      zoom: 8,\n      style: {\n        height: '600px',\n        width: '100%'\n      },\n      children: [/*#__PURE__*/_jsxDEV(TileLayer, {\n        url: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\n        attribution: \"\\xA9 OpenStreetMap contributors\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 9\n      }, this), updateMap(data)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"dataDisplay\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Received Data\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"pre\", {\n        id: \"dataOutput\",\n        children: JSON.stringify(data, null, 2)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 88,\n    columnNumber: 5\n  }, this);\n};\n_s(WebSocketMap, \"Un2085OchEh3Ns39wdEm8V7j4Zo=\");\n_c = WebSocketMap;\nexport default WebSocketMap;\nvar _c;\n$RefreshReg$(_c, \"WebSocketMap\");","map":{"version":3,"names":["React","useEffect","useState","MapContainer","TileLayer","Marker","Popup","L","jsxDEV","_jsxDEV","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl","WebSocketMap","_s","data","setData","socket","setSocket","connectWebSocket","newSocket","WebSocket","onopen","console","log","onmessage","event","receivedData","JSON","parse","onclose","setTimeout","onerror","error","close","updateMap","map","item","index","latitude","longitude","data_series_id","location","popupContent","name","startsWith","windSpeed","windGusts","precipitation","pm10","pm25","ozon","no2","position","children","dangerouslySetInnerHTML","__html","fileName","_jsxFileName","lineNumber","columnNumber","center","zoom","style","height","width","url","attribution","id","stringify","_c","$RefreshReg$"],"sources":["C:/vscProjekti/spletno/AtmoTracker/frontend/src/components/WebSocketMap.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { MapContainer, TileLayer, Marker, Popup } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\n\r\n// Fix the default icon issue with Leaflet in React\r\ndelete L.Icon.Default.prototype._getIconUrl;\r\nL.Icon.Default.mergeOptions({\r\n  iconRetinaUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon-2x.png',\r\n  iconUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',\r\n  shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png'\r\n});\r\n\r\nconst WebSocketMap = () => {\r\n  const [data, setData] = useState([]);\r\n  const [socket, setSocket] = useState(null);\r\n\r\n  const connectWebSocket = () => {\r\n    const newSocket = new WebSocket('ws://localhost:3002');\r\n\r\n    newSocket.onopen = () => {\r\n      console.log('Connected to WebSocket server');\r\n    };\r\n\r\n    newSocket.onmessage = (event) => {\r\n      const receivedData = JSON.parse(event.data);\r\n      console.log('Received data:', receivedData);\r\n      setData(receivedData);\r\n    };\r\n\r\n    newSocket.onclose = (event) => {\r\n      console.log('Disconnected from WebSocket server', event);\r\n      // Reconnect after a short delay\r\n      setTimeout(connectWebSocket, 1000);\r\n    };\r\n\r\n    newSocket.onerror = (error) => {\r\n      console.error('WebSocket error:', error);\r\n    };\r\n\r\n    setSocket(newSocket);\r\n  };\r\n\r\n  useEffect(() => {\r\n    connectWebSocket();\r\n\r\n    return () => {\r\n      if (socket) {\r\n        console.log('Closing WebSocket connection');\r\n        socket.close();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const updateMap = (data) => {\r\n    return data.map((item, index) => {\r\n      const { latitude, longitude } = item.data_series_id.location;\r\n      let popupContent = `<strong>${item.data_series_id.name}</strong><br>No relevant data available.`;\r\n\r\n      if (item.data_series_id.name.startsWith('Weather')) {\r\n        popupContent = `\r\n          <strong>${item.data_series_id.name}</strong><br>\r\n          Wind Speed: ${item.data.windSpeed || 'N/A'}<br>\r\n          Wind Gusts: ${item.data.windGusts || 'N/A'}<br>\r\n          Precipitation: ${item.data.precipitation || 'N/A'}\r\n        `;\r\n      } else if (item.data_series_id.name.startsWith('AirQuality')) {\r\n        popupContent = `\r\n          <strong>${item.data_series_id.name}</strong><br>\r\n          PM10: ${item.data.pm10 || 'N/A'}<br>\r\n          PM2.5: ${item.data.pm25 || 'N/A'}<br>\r\n          Ozone: ${item.data.ozon || 'N/A'}<br>\r\n          NO2: ${item.data.no2 || 'N/A'}\r\n        `;\r\n      }\r\n\r\n      return (\r\n        <Marker key={index} position={[latitude, longitude]}>\r\n          <Popup>\r\n            <div dangerouslySetInnerHTML={{ __html: popupContent }} />\r\n          </Popup>\r\n        </Marker>\r\n      );\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <MapContainer center={[46.11929097137821, 14.756128960803503]} zoom={8} style={{ height: '600px', width: '100%' }}>\r\n        <TileLayer\r\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n          attribution=\"Â© OpenStreetMap contributors\"\r\n        />\r\n        {updateMap(data)}\r\n      </MapContainer>\r\n      <div id=\"dataDisplay\">\r\n        <h2>Received Data</h2>\r\n        <pre id=\"dataOutput\">{JSON.stringify(data, null, 2)}</pre>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default WebSocketMap;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}